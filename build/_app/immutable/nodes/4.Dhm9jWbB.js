import{t as y,a as w}from"../chunks/CqjSVEbv.js";import"../chunks/_UzjNI5l.js";import{Y as N,Z as O,g as r,_ as R,U as i,T as o,W as b,V as n,$ as U,Q as p,a0 as $,X as q}from"../chunks/BliiSLIs.js";import{e as B,s as G}from"../chunks/Dm6szSeO.js";import{a as J,p as W}from"../chunks/DUQ0dEfB.js";import{s as Z,r as A,A as Q}from"../chunks/BH2huBuZ.js";import{b as C}from"../chunks/CuivAu7y.js";import{b as D}from"../chunks/BeKjXOaR.js";var V=y('<div class="alert variant-filled-error"> </div>'),X=y(`<div class="
    flex justify-center pt-10 items-start min-h-screen
    bg-cover 
    bg-center 
    bg-no-repeat
  "><div class="card p-4 w-[90%] sm:w-2/3 md:w-1/3"><form class="space-y-4"><h2 class="h2">Login</h2> <!> <label class="label"><span>Email</span> <input class="input" type="email" placeholder="Enter your email" required></label> <label class="label"><span>Password</span> <input class="input" type="password" placeholder="Enter your password" required></label> <button type="submit" class="btn variant-filled-primary w-full">Login</button> <div class="flex items-center space-x-2"><span>Need an account?</span> <a href="/register" class="text-blue-500 underline">Register</a></div></form></div></div>`);function Y(m,c){N(c,!0);let s=b(""),l=b(""),_,k,d=b(""),P="/images/jeremy-ricketts-6ZnhM-xBpos-unsplash.jpg";const I=async e=>{e.preventDefault();try{const a=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r(s),password:r(l)}),credentials:"include"});console.log("Response status:",a.status);const t=await a.json();if(console.log("Response data:",t),a.ok&&t.login_success){console.log("Login successful:",t);const L={id:t.user_id,username:t.username,email:t.email,tokenExpires:Date.now()+180*1e3};console.log("Storing user data:",L),localStorage.setItem("user",JSON.stringify(L)),setTimeout(async()=>{try{const T=await(await fetch("/verify-auth",{method:"GET",credentials:"include"})).json();console.log("Auth verification after login:",T),T.is_authenticated||console.warn("Warning: Server did not confirm authentication"),window.location.href="/recommendation"}catch(S){console.error("Auth check error:",S),window.location.href="/recommendation"}},100)}else console.error("Login failed:",t.message),p(d,W(t.message||"Login Unsuccessful. Please check email and password"))}catch(a){console.error("There was a problem with the login operation:",a),p(d,"Login Unsuccessful. Please check email and password")}};O(async()=>{try{const a=await(await fetch("/verify-auth",{method:"GET",credentials:"include"})).json();console.log("Initial auth check:",a),a.is_authenticated&&(window.location.href="/recommendation")}catch(e){console.error("Auth check error:",e)}});var u=X();Z(u,"style",`background-image: url('${P}');`);var x=o(u),h=o(x),E=i(o(h),2);{var M=e=>{var a=V(),t=o(a,!0);n(a),$(()=>G(t,r(d))),w(e,a)};J(E,e=>{r(d)&&e(M)})}var f=i(E,2),g=i(o(f),2);A(g),D(g,e=>_=e,()=>_),n(f);var j=i(f,2),v=i(o(j),2);A(v),D(v,e=>k=e,()=>k),n(j),U(4),n(h),n(x),n(u),B("submit",h,I),C(g,()=>r(s),e=>p(s,e)),C(v,()=>r(l),e=>p(l,e)),w(m,u),R()}var z=y("<!> <!>",1);function oe(m){var c=z(),s=q(c);Q(s,{});var l=i(s,2);Y(l,{}),w(m,c)}export{oe as component};
