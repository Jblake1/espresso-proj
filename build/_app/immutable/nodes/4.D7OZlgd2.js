import{t as y,a as b}from"../chunks/W4TM1z4w.js";import"../chunks/CzBPpHCt.js";import{p as O,g as o,j as R,s as n,k as r,m as w,n as i,o as q,t as u,v as G,f as I}from"../chunks/CZLb4j7O.js";import{e as J,s as M}from"../chunks/DdtZw0U8.js";import{i as U,p as B}from"../chunks/B0R6SzIc.js";import{r as A,A as W}from"../chunks/CgDm25Dn.js";import{b as C}from"../chunks/CcHsVTgv.js";import{b as D}from"../chunks/DyNmgrdo.js";import{o as $}from"../chunks/B49uhO74.js";var z=y('<div class="alert variant-filled-error"> </div>'),F=y('<div class="flex justify-center items-center min-h-screen"><div class="card p-4 w-[90%] sm:w-2/3 md:w-1/3"><form class="space-y-4"><h2 class="h2">Login</h2> <!> <label class="label"><span>Email</span> <input class="input" type="email" placeholder="Enter your email" required></label> <label class="label"><span>Password</span> <input class="input" type="password" placeholder="Enter your password" required></label> <button type="submit" class="btn variant-filled-primary w-full">Login</button> <div class="flex items-center space-x-2"><span>Need an account?</span> <a href="/register" class="text-blue-500 underline">Register</a></div></form></div></div>');function H(p,c){O(c,!0);let t=w(""),l=w(""),_,k,d=w("");const P=async e=>{e.preventDefault();try{const a=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o(t),password:o(l)}),credentials:"include"});console.log("Response status:",a.status);const s=await a.json();if(console.log("Response data:",s),a.ok&&s.login_success){console.log("Login successful:",s);const S={id:s.user_id,username:s.username,email:s.email,tokenExpires:Date.now()+180*1e3};console.log("Storing user data:",S),localStorage.setItem("user",JSON.stringify(S)),setTimeout(async()=>{try{const T=await(await fetch("/verify-auth",{method:"GET",credentials:"include"})).json();console.log("Auth verification after login:",T),T.is_authenticated||console.warn("Warning: Server did not confirm authentication"),window.location.href="/"}catch(j){console.error("Auth check error:",j),window.location.href="/"}},100)}else console.error("Login failed:",s.message),u(d,B(s.message||"Login Unsuccessful. Please check email and password"))}catch(a){console.error("There was a problem with the login operation:",a),u(d,"Login Unsuccessful. Please check email and password")}};$(async()=>{try{const a=await(await fetch("/verify-auth",{method:"GET",credentials:"include"})).json();console.log("Initial auth check:",a),a.is_authenticated&&(window.location.href="/")}catch(e){console.error("Auth check error:",e)}});var m=F(),x=r(m),h=r(x),E=n(r(h),2);{var N=e=>{var a=z(),s=r(a,!0);i(a),G(()=>M(s,o(d))),b(e,a)};U(E,e=>{o(d)&&e(N)})}var f=n(E,2),v=n(r(f),2);A(v),D(v,e=>_=e,()=>_),i(f);var L=n(f,2),g=n(r(L),2);A(g),D(g,e=>k=e,()=>k),i(L),q(4),i(h),i(x),i(m),J("submit",h,P),C(v,()=>o(t),e=>u(t,e)),C(g,()=>o(l),e=>u(l,e)),b(p,m),R()}var K=y("<!> <!>",1);function oe(p){var c=K(),t=I(c);W(t,{});var l=n(t,2);H(l,{}),b(p,c)}export{oe as component};
